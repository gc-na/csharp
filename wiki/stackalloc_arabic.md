<!--
Meta Description: # استخدام stackalloc في C# ## ملخص يعتبر الأمر `stackalloc` في لغة C# من الأدوات المهمة لإنشاء مصفوفات على المكدس (stack) بدلاً من كومة الذاكرة (heap)...
Meta Keywords: stackalloc, الذاكرة, استخدام, يمكن, الأنواع
-->

# استخدام stackalloc في C#

## ملخص
يعتبر الأمر `stackalloc` في لغة C# من الأدوات المهمة لإنشاء مصفوفات على المكدس (stack) بدلاً من كومة الذاكرة (heap)، مما يحسن من أداء البرنامج ويقلل من ضغط إدارة الذاكرة.

## الوثائق
### الغرض
يتيح لك `stackalloc` تخصيص ذاكرة لمصفوفة صغيرة من القيم مباشرة على المكدس. هذا مفيد بشكل خاص عندما تحتاج إلى مصفوفات ذات حجم ثابت والتي لا تتطلب دورة حياة طويلة.

### الاستخدام
يمكن استخدام `stackalloc` مع الأنواع القيمة (value types) مثل `int`، `float`، أو `struct`. يتم تعريف المصفوفة باستخدام الكلمة المفتاحية `stackalloc` متبوعة بحجم المصفوفة المطلوبة.

#### الصيغة العامة:
```csharp
T[] array = stackalloc T[size];
```
حيث `T` هو نوع العناصر و `size` هو عدد العناصر في المصفوفة.

### التفاصيل
- **النطاق**: يتم تخصيص الذاكرة على المكدس، مما يعني أن المصفوفة ستظل موجودة فقط خلال نطاق الدالة التي تم إنشاؤها فيها.
- **الأداء**: يعد `stackalloc` أسرع من تخصيص الذاكرة على الكومة، حيث إنه لا يحتاج إلى إدارة الذاكرة المعقدة.
- **القيود**: يمكن استخدام `stackalloc` فقط مع الأنواع القيمة، ولا يمكن استخدامه مع الأنواع المرجعية (reference types).

## أمثلة
### مثال أساسي:
```csharp
public void Example()
{
    Span<int> numbers = stackalloc int[5];
    for (int i = 0; i < numbers.Length; i++)
    {
        numbers[i] = i * 2;
    }
}
```
### مثال مع الأنواع المخصصة:
```csharp
public struct Point
{
    public int X;
    public int Y;
}

public void CreatePoints()
{
    Span<Point> points = stackalloc Point[3];
    points[0] = new Point { X = 1, Y = 2 };
    points[1] = new Point { X = 3, Y = 4 };
    points[2] = new Point { X = 5, Y = 6 };
}
```

## الشرح
### الأخطاء الشائعة
- **تخصيص الذاكرة الكبيرة**: لا تستخدم `stackalloc` لمصفوفات كبيرة، حيث يمكن أن يؤدي ذلك إلى تجاوز المكدس (stack overflow).
- **استخدام الأنواع المرجعية**: لا يمكن استخدام `stackalloc` مع الأنواع المرجعية مثل الكائنات (objects)، مما يمكن أن يؤدي إلى عدم فهم الاستخدام الصحيح.

### ملاحظات إضافية
- `stackalloc` مفيد بشكل خاص مع بنى البيانات المؤقتة التي تحتاجها فقط ضمن نطاق معين.
- تأكد من عدم استخدام المصفوفات المخصصة بـ `stackalloc` خارج نطاق الدالة التي تم إنشاؤها فيها لتجنب سلوك غير متوقع.

## ملخص بجملة واحدة
`stackalloc` في C# هو وسيلة فعالة لتخصيص مصفوفات صغيرة على المكدس، مما يحسن من الأداء ويقلل من إدارة الذاكرة.